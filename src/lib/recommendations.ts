import { IndicatorConfig, Level, Recommendation } from "@/types";
import { weakestIndicators } from "./materiality";

const recommendationLibrary: Recommendation[] = [
  {
    indicatorCode: "E1",
    level: "initial",
    title: "Эрчим хүчээ хэмжиж, ил болго",
    actions: [
      "Үндсэн хэмжүүрүүд (кВтц, м² тутамд хэрэглээ) дээр жилээс жилд харьцуулалт хийнэ.",
      "Веб дээр суурь жил, одоогийн хэрэглээний хүснэгт байрлуул.",
      "Сэргээгдэх эх үүсвэр нэвтрүүлэхэд шаардагдах хөрөнгө, түншүүдийг жагсаа.",
    ],
  },
  {
    indicatorCode: "E1",
    level: "development",
    title: "Сэргээгдэх хувь, бууруулах зорилт тогтоо",
    actions: [
      "Сэргээгдэх эх үүсвэрийн хувийг жил бүрийн зорилттой болгож баталгаажуул.",
      "ISO 50001 эсвэл эрчим хүчний удирдлагын протокол ашиглан хяналтын цикл нэвтрүүл.",
      "Хөрөнгө оруулалтын зах зээл (ESCO, green loan) ашиглах боломжийг судал.",
    ],
  },
  {
    indicatorCode: "E2",
    level: "initial",
    title: "Нүүрстөрөгчийн сууриа гарга",
    actions: [
      "Scope 1, 2-ийн хэрэглээг сарын тайлангаар нэгтгэж CO₂e-р хувирга.",
      "Веб дээр суурь жилийн тооцоог богино тайлбартай байршуул.",
      "Ялгарлын мэдээллийг баталгаажуулах эзэн, багийг томил.",
    ],
  },
  {
    indicatorCode: "E2",
    level: "development",
    title: "SBTi/Net Zero зорилтоо баталгаажуул",
    actions: [
      "Scope 1-3 бүрэн тооцооллыг шинээр хийж, гадаад зөвлөхөөр шалгуул.",
      "SBTi эсвэл Net Zero зорилгыг албан ёсоор бүртгүүлж, шилжилтийн зам гарга.",
      "Жил бүр баталгаажсан аудитын тайланг олон нийтэд нийтэл.",
    ],
  },
  {
    indicatorCode: "E3",
    level: "initial",
    title: "Ногоон кампусын суурь зураглал",
    actions: [
      "Кампусын ногоон талбай, хатуу хучилттай талбайг зурагжуулж хэмж.",
      "Веб дээр кампусын газрын зургийг нийтэлж, ногоон бүсүүдийг тэмдэглэ.",
      "Ногоон барилгын үндсэн шаардлага (LED, дулаалга) бүхий чеклист ашигла.",
    ],
  },
  {
    indicatorCode: "E3",
    level: "development",
    title: "Сертификат ба зорилтот м²/оюутан",
    actions: [
      "LEED/EDGE урьдчилсан үнэлгээ хийлгэж, шаардлагатай хөрөнгө оруулалтыг төлөвлө.",
      "Ногоон талбай/оюутан 10м² зорилтыг баталгаажуулж, жил бүр хэмж.",
      "Шинэ барилгын ТЗ-д ногоон шаардлага тусгагдсан эсэхийг хянана.",
    ],
  },
  {
    indicatorCode: "E4",
    level: "initial",
    title: "Усны хэрэглээг хэмжих",
    actions: [
      "Усны тоолуур байршуулж, сар бүрийн хэрэглээг бүртгэ.",
      "Гол алдагдлын цэгүүд (жорлон, лаборатори) дээр хурдан аудит хий.",
      "Веб дээр усны хэрэглээний график, суурь жилээ нийтэл.",
    ],
  },
  {
    indicatorCode: "E4",
    level: "development",
    title: "Дахин ашиглалт ба зорилт",
    actions: [
      "Борооны ус цуглуулах, дахин ашиглах системийн ТЭЗҮ боловсруул.",
      "Салбар бүрт усны бууруулалтын KPI тавьж, сар бүр тайлагна.",
      "Ухаалаг мэдрэгч ашиглаж алдагдлыг бодитоор хянах систем суурилуул.",
    ],
  },
  {
    indicatorCode: "E5",
    level: "initial",
    title: "Хог ангилалт эхлүүлэх",
    actions: [
      "Кампусын гол цэгүүдэд ангилан ялгах сав байршуулж, дүрэм тараа.",
      "Цуглуулалт хийдэг ханган нийлүүлэгчтэй гэрээ байгуул.",
      "Сарын хэмжээнд ангилсан тоо хэмжээгээ хэмжиж эхэл.",
    ],
  },
  {
    indicatorCode: "E5",
    level: "development",
    title: "Төрлөөр тайлагнаж, 40%+ дахин боловсруулалт",
    actions: [
      "Хогийг төрлөөр жинлэж, дахин боловсруулалтын хувийг тооц.",
      "Дахин боловсруулалтын 40%-ийн зорилтыг хүрэх төлөвлөгөө гарга.",
      "Нийлүүлэгчтэй гэрээг KPI-тэй болгож, улирал бүр хамт дүгнэ.",
    ],
  },
  {
    indicatorCode: "E6",
    level: "initial",
    title: "Био олон янз байдлын суурь",
    actions: [
      "Кампусын мод, ургамлын анхан жагсаалтыг оюутнуудаар хийлгэ.",
      "Ургамал тарилтын улирлын төлөвлөгөө гаргаж, хэрэгжилтийг нийтэл.",
      "Хордуулагч бодис (химийн бордоо) ашиглалтад хяналт тогтоо.",
    ],
  },
  {
    indicatorCode: "E6",
    level: "development",
    title: "Менежментийн төлөвлөгөө",
    actions: [
      "Экологич зөвлөхтэй хамт ургамал/амьтны судалгаа хий.",
      "5 жилтэй био олон янз байдлын менежментийн төлөвлөгөө баталгаажуул.",
      "Хяналт-шинжилгээний үзүүлэлтүүд (төрөл зүйл, ногоон индекс) тогтоож нийтэл.",
    ],
  },
  {
    indicatorCode: "E7",
    level: "initial",
    title: "Ногоон худалдан авалтын шаардлага",
    actions: [
      "Бүх худалдан авалтын гэрээний загварт ногоон шаардлага нэм.",
      "Нийлүүлэгчдийн ёс зүйн/байгаль орчны мэдэгдэл цуглуул.",
      "Урьдчилсан шалгуур чеклистийг нийтэлж ил тод болго.",
    ],
  },
  {
    indicatorCode: "E7",
    level: "development",
    title: "Нийлүүлэгчийн ESG үнэлгээ",
    actions: [
      "Нийлүүлэгчдэд ESG онооны карт боловсруулж жил бүр үнэл.",
      "Оноо өндөр нийлүүлэгчдэд давуу эрх олгох бодлого баталгаажуул.",
      "Эрсдэл өндөр нийлүүлэгчдэд сайжруулалтын төлөвлөгөө хамт байгуул.",
    ],
  },
  {
    indicatorCode: "S1",
    level: "initial",
    title: "Судалгааны суурь хэмжүүр",
    actions: [
      "Scopus/WoS-д бүртгэлтэй бүтээлийг нэгтгэж, нээлттэй репод байршуул.",
      "Судалгааны семинарын тогтмол календар гарга.",
      "Судалгааны бодит үр дүнг харуулах кейс сториг веб дээр нэм.",
    ],
  },
  {
    indicatorCode: "S1",
    level: "development",
    title: "Нийгмийн нөлөөллийг хэмж",
    actions: [
      "Altmetric, citation impact зэрэг үзүүлэлтээр бүтээл бүрийн нөлөөллийг тооц.",
      "Салбар хоорондын хамтарсан лаборатори байгуулж, үр дүнг жил бүр нийтэл.",
      "Нийгмийн нөлөөлөлтэй судалгаанд урамшууллын схем боловсруул.",
    ],
  },
  {
    indicatorCode: "S2",
    level: "initial",
    title: "Эрх тэгш байдлын ил тод байдал",
    actions: [
      "Жендер, ХБЭҮ бодлогоо веб дээр нийтэлж, хариуцах нэгж томил.",
      "Кампусын хүртээмжийн газрын зураг (рамп, лифт) нийтэл.",
      "Энгийн KPI (оюутан/ажилтны харьцаа, хүйсийн харьцаа) тогтоож хэмж.",
    ],
  },
  {
    indicatorCode: "S2",
    level: "development",
    title: "Жил тутмын эрх тэгш байдлын тайлан",
    actions: [
      "Жендерийн цалингийн зөрүү, ахицын анализ хийж тайланд тусга.",
      "Хөгжлийн бэрхшээлтэй оюутны үйлчилгээний хүртээмжийг KPI-тай хэмж.",
      "Оролцооны зорилтууд (гэрээт ажилтан, удирдах албан тушаал) баталгаажуул.",
    ],
  },
  {
    indicatorCode: "S3",
    level: "initial",
    title: "ТХБ-ийн агуулга оруулах",
    actions: [
      "Бүх мэргэжлийн оюутанд зориулсан нэгж кредитийн ТХБ/SDG модуль бэлд.",
      "SDG өдрүүд, семинар зохион байгуулж материалуудыг архивла.",
      "Хариуцах багш, түнш байгууллагыг томилж ажиллуулах.",
    ],
  },
  {
    indicatorCode: "S3",
    level: "development",
    title: "Заавал сургалт ба баталгаажуулалт",
    actions: [
      "SDG/ESD хичээлийг бүх оюутанд заавал болгож, суралцах үр дүнг хэмж.",
      "UNESCO ESD эсвэл ижил төстэй гэрчилгээ авах roadmap боловсруул.",
      "Курсын үнэлгээнд бодит кейс, нөлөөллийн төсөл оруул.",
    ],
  },
  {
    indicatorCode: "S4",
    level: "initial",
    title: "Ажилтны сургалтын суурь",
    actions: [
      "Жилийн сургалтын календар гаргаж, суурь ур чадварыг тодорхойл.",
      "Шинэ ажилтны онбординг-д ESG/ХАБЭА модулиуд нэм.",
      "Оролцооны түвшинг сар бүр хэмжиж, тасралтгүй сайжруул.",
    ],
  },
  {
    indicatorCode: "S4",
    level: "development",
    title: "Индивидуал хөгжлийн төлөвлөгөө",
    actions: [
      "Бүх ажилтанд хувь хүний хөгжлийн төлөвлөгөө (IDP) баталгаажуул.",
      "Сургалтын төсвийг нэг ажилтан дээр тогтмол хэмжих KPI тогтоо.",
      "Жил бүрийн сэтгэл ханамжийн судалгааг үр дүнтэйгээр хаан дүгнэ.",
    ],
  },
  {
    indicatorCode: "S5",
    level: "initial",
    title: "Нийгмийн оролцооны тогтмол байдал",
    actions: [
      "Жилд дор хаяж 2 нийгмийн төсөл (цагаан таяг, мод тарих) төлөвлө.",
      "Оролцсон сайн дурын цагийг бүртгэж эхэл.",
      "Кейс сториг веб дээр нийтэлж, хамтрагчдыг дурд.",
    ],
  },
  {
    indicatorCode: "S5",
    level: "development",
    title: "Нөлөөллийг хэмжиж, хамтрагчдаа удирд",
    actions: [
      "Social ROI эсвэл хүрсэн хүний тоо, чанарын үзүүлэлтээр хэмж.",
      "Орон нутгийн байгууллагатай хамтарсан зураглал хийж, төсөл сонгох шалгуур батал.",
      "Нийт үр дүнг ил тод самбар дээр улирал бүр шинэчил.",
    ],
  },
  {
    indicatorCode: "S6",
    level: "initial",
    title: "ХАБЭА суурь тогтолцоо",
    actions: [
      "ХАБЭА бодлого, дүрмээ веб дээр байршуулж, танилцуулга хий.",
      "Ослын бүртгэлийн журмыг хэрэгжүүлж, 0 инцидент зорилтыг зарла.",
      "Аюулгүй ажиллагааны сургалтыг улирал бүр явуул.",
    ],
  },
  {
    indicatorCode: "S6",
    level: "development",
    title: "ISO 45001-д дөхөх",
    actions: [
      "ISO 45001-ийн өөрийн үнэлгээг хийж, зөрчлийг багасгах төлөвлөгөө гарга.",
      "Галын болон нүүлгэн шилжүүлэх сургуулилт улирал бүр хий.",
      "LTIFR/ослын тоог бууруулах зорилт тавьж, гүйцэтгэлийг олон нийтэд зарла.",
    ],
  },
  {
    indicatorCode: "S7",
    level: "initial",
    title: "Оюутны санал авах сувгууд",
    actions: [
      "Жил бүр оюутны сэтгэл ханамжийн богино судалгаа явуул.",
      "24/7 санал хүсэлтийн digital сувгийг нээж, хариулах SLA тогтоо.",
      "Судалгааны хурдан сайжруулалтуудыг нийтэлж итгэлийг нэм.",
    ],
  },
  {
    indicatorCode: "S7",
    level: "development",
    title: "Сэтгэцийн эрүүл мэндийг бүрэн хангах",
    actions: [
      "Сэтгэцийн эрүүл мэндийн зөвлөгөөний үйлчилгээний хүртээмжийг 100% болго.",
      "Оюутны үйлчилгээ бүрт үйлчилгээний түвшний гэрээ (SLA) тогтоож хэмж.",
      "Жил бүрийн судалгааны үр дүнг олон нийтэд тайлагнаж, сайжруулалтын төлөвлөгөө нийтэл.",
    ],
  },
  {
    indicatorCode: "S8",
    level: "initial",
    title: "Инновацийн экосистемийг асаа",
    actions: [
      "IP/патентийн үндсэн журмыг баталж, оюутан багшид танилцуул.",
      "Иновацийн клуб, менторын сүлжээ байгуулж, сар бүр уулзалт хий.",
      "Бичил буцалтгүй сан эсвэл шагналын сан бий болго.",
    ],
  },
  {
    indicatorCode: "S8",
    level: "development",
    title: "Гарааны бизнесийн pipeline",
    actions: [
      "Инкубаторын KPI (5+ гарааны компани, 100 сая₮+ санхүүжилт) тогтоож хяна.",
      "Оюутан гарааны төслүүдэд зориулсан seed сан бүрдүүл.",
      "Патентын өргөдөл, лицензийн орлогыг жил бүрийн тайланд тусга.",
    ],
  },
  {
    indicatorCode: "G1",
    level: "initial",
    title: "ESG удирдлагын эзэн тодорхой",
    actions: [
      "ТХ/БОНЗ-ийн хариуцсан хүнийг томилж, мандаттай нь нийтэл.",
      "Засаглалын бүтэц, тайлагналын давтамжийг веб дээр харуул.",
      "Сургуулийн удирдлагад ESG үзүүлэлтийг тогтмол хэлэлцэх хуваарь гарга.",
    ],
  },
  {
    indicatorCode: "G1",
    level: "development",
    title: "ESG зөвлөл, төлөвлөгөө",
    actions: [
      "ESG/ТХ-ийн зөвлөл байгуулаад жил, улирлын ажлын хөтөлбөр батал.",
      "Гүйцэтгэлийн тайланг жил бүр нийтэлж, гол шийдвэрүүдийг онцол.",
      "Удирдлагын шагнал, шийдвэрт ESG KPI-г уяж өгөх журам боловсруул.",
    ],
  },
  {
    indicatorCode: "G2",
    level: "initial",
    title: "Ёс зүйг ил болго",
    actions: [
      "Ёс зүйн дүрэм, бэлэн загвар баримт бичгийг веб дээр байршуул.",
      "Ажилтан, оюутанд зориулсан богино цахим сургалт зохион байгуул.",
      "Шүгэл үлээгчийн сувгийг нээж, мэдээлэл хамгаалах журмыг нийтэл.",
    ],
  },
  {
    indicatorCode: "G2",
    level: "development",
    title: "ISO 37001-д бэлтгэх",
    actions: [
      "Авилгын эрсдлийн үнэлгээ хийж, хяналтын матриц гарга.",
      "Гадаад аудит эсвэл өөрийн үнэлгээ хийлгэж сайжруулалтын төлөвлөгөө батал.",
      "Нийлүүлэгч, түншүүдэд ёс зүйн шалгуур бүхий скрининг хийнэ.",
    ],
  },
  {
    indicatorCode: "G3",
    level: "initial",
    title: "Ил тод санхүү",
    actions: [
      "Жилийн санхүүгийн тайланг веб дээр PDF хэлбэрээр нийтэл.",
      "ESG-тэй холбоотой зардал, хөрөнгө оруулалтын мөрийг ялгаж харуул.",
      "Санхүү хариуцах багийн холбоо барих мэдээллийг нийтэл.",
    ],
  },
  {
    indicatorCode: "G3",
    level: "development",
    title: "Ногоон санхүүжилтэд дөхөх",
    actions: [
      "Интегрэйтед тайлан (санхүү + ESG)-д шилжих төлөвлөгөө гарга.",
      "Ногоон бонд эсвэл тогтвортой санхүүжилтийн шаардлагуудыг үнэл.",
      "ESG capex/opex-ийг тусад нь хянах дотоод процесс бий болго.",
    ],
  },
  {
    indicatorCode: "G4",
    level: "initial",
    title: "Түншлэлийн зураглал",
    actions: [
      "Олон улсын түншлэл, МУБ-үүдийн жагсаалтыг шинэчилж веб дээр тавь.",
      "Түншлэлийн мэдээллийн сан (CRM) үүсгэж, хариуцах эзэн томил.",
      "Түншлэлтэй арга хэмжээг улирал бүр төлөвлөж нийтэл.",
    ],
  },
  {
    indicatorCode: "G4",
    level: "development",
    title: "ESG чиглэлийн түншлэл",
    actions: [
      "ТХ/БОНЗ чиглэлээр 2-3 стратегийн MoU байгуулж, хамтарсан төслийн KPI тогтоо.",
      "Хамтын төсөл бүрийн үр дүнг тайлагнаж, веб дээр нийтэл.",
      "Байгууллагын дотоод системд түншлэлийн эрсдлийг үнэлж хяна.",
    ],
  },
  {
    indicatorCode: "G5",
    level: "initial",
    title: "Эрсдэлийн жагсаалт",
    actions: [
      "Топ 10 эрсдэлийн жагсаалт, эзэн, бууруулах арга хэмжээг тогтмол шинэчил.",
      "Эрсдэлийн бүртгэлийг улирал бүр хянах товч хурлын календар гарга.",
      "Чанарын үндсэн журам, чеклистийг бүх нэгжид түгээнэ.",
    ],
  },
  {
    indicatorCode: "G5",
    level: "development",
    title: "ISO 9001/31000 руу шилжих",
    actions: [
      "ISO 9001/31000 өөрийн үнэлгээг хийж, зөрчлийг бууруулах roadmap гарга.",
      "Стресс тест, бизнес тасралтгүй ажиллагааны дасгал хий.",
      "Удирдах зөвлөлд эрсдэлийн дашбоард тогтмол танилцуулах журам батал.",
    ],
  },
];

export function buildRecommendations(
  level: Level,
  scores: Record<string, number>,
  config: IndicatorConfig[],
  limit = 5,
) {
  const weak = weakestIndicators(scores, config, limit);

  return weak.map(({ indicator, score }) => {
    const match = recommendationLibrary.find(
      (entry) =>
        entry.indicatorCode === indicator.code && entry.level === level,
    );

    const fallbackTitle = `${indicator.label}: дараагийн шатны алхам`;
    const fallbackActions = [
      "Суурь мэдээллээ бүрэн хэмжиж, жил тутам харьцуулж эхэл.",
      "Хариуцлагатай эзэн, тоон KPI-г тогтоож, веб дээр ил тод байлга.",
      "Гадаад баталгаажуулалт эсвэл хамтын түншлэл хайж, хэрэгжилтээ хурдатга.",
    ];

    return {
      code: indicator.code,
      label: indicator.label,
      score,
      impact: indicator.impact,
      title: match?.title ?? fallbackTitle,
      actions: match?.actions ?? fallbackActions,
    };
  });
}

export function recommendationLibraryFor(code: string, level: Level) {
  return recommendationLibrary.find(
    (entry) => entry.indicatorCode === code && entry.level === level,
  );
}

export const shortScoreLegend = [
  { value: 0, label: "Огт мэдээлэл байхгүй" },
  { value: 1, label: "Ерөнхий мэдэгдэл (~25%)" },
  { value: 2, label: "Хагас дутуу (~50%)" },
  { value: 3, label: "Ихэнх нь хийгдсэн (~75%)" },
  { value: 4, label: "Бүрэн, баталгаатай (~100%)" },
];
